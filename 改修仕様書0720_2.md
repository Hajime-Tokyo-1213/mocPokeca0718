# 改修仕様書 (ver 0720_2)

## 1. 概要
アプリケーションに表示されるポケモンカードに、それぞれの画像を表示する機能を追加する。

## 2. 目的
- カードの視覚的な識別を容易にし、ユーザー体験を向上させる。
- より直感的に目的のカードを探せるようにする。

## 3. 仕様詳細

### 3.1. データ取得元（画像URL）
- **データソース:** Googleスプレッドシート
- **URL:** `https://docs.google.com/spreadsheets/d/1e1QaldVK3sueAw_t90fuGL8p-GdhLMPuRivPqdFk9lg/edit`
- **対象シート:** 「シート1」を除く、存在するすべてのシート。各シートはレアリティごとに分割されている。
- **取得対象カラム:**
    - C列: `タイトル` (照合に使用)
    - E列: `画像URL` (表示に使用)

### 3.2. データ取得・加工プロセス
1.  **URL抽出:**
    - E列のデータは `=IMAGE("...")` という関数形式で格納されている。正規表現などを用いて、ダブルクォーテーション内のURL文字列のみを抽出する。
2.  **タイトル情報のパース:**
    - C列のタイトル文字列から、照合に不要な情報を削除し、必要な情報を抽出する。
    - **元データ形式の例:** `【状態B】マキシ SR SM5+ 056/050`
    - **加工プロセス:**
        - `【状態B】` のような、角括弧で囲まれた接頭辞を除去する。
        - 残った文字列 `マキシ SR SM5+ 056/050` から、「キャラクター名」と「型番」を抽出する。
            - **キャラクター名:** 最初のスペースまでの文字列 (`マキシ`)。
            - **型番:** レアリティ表記の後の部分 (`SM5+ 056/050`)。

### 3.3. 画像URLの照合ロジック
既存のカードデータ（`ALLData`由来）に画像URLを紐付けるための照合処理。

1.  **一次絞り込み (型番での照合):**
    - 既存データが持つ `商品型番` を使用し、加工済みの画像データリストから型番が一致するものをすべて検索する。
2.  **二次絞り込み (キャラクター名での照合):**
    - 一次絞り込みの結果、候補が複数存在する場合に実行する。
    - 既存データの `商品タイトル` に、画像データから抽出した `キャラクター名` が含まれているかどうかでフィルタリングする。
3.  **最終決定:**
    - 上記の絞り込みを経て、最終的に一致した1件の画像URLを、該当カードの `imageUrl` として採用する。

### 3.4. 表示処理
- **画像が見つかった場合:** 照合ロジックによって特定された `imageUrl` を用いて画像を表示する。
- **画像が見つからなかった場合:** ローカルに配置したプレースホルダー画像（例: `public/no-image.png`）を表示する。

## 4. 実装方針
- 画像URLリストは、アプリケーションのビルド時またはサーバーサイドで取得し、全カード情報に事前に紐付けておく。
- スプレッドシートの全シートから非同期でデータを取得し、マージする処理を実装する。
- タイトル文字列のパースやURL抽出のためのユーティリティ関数を作成する。

## 5. 改修範囲外
- ユーザーによる画像のアップロード機能。
- スプレッドシート以外の場所からの画像取得。 